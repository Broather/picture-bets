<!doctype html>
<html lang="eng">

    <head>
        <script type="module" src="game_logic.js"></script>
        <meta charset="utf-8">
        <title></title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="style.css">
    </head>

    <body>
        <a href="index.html">main menu</a>
        <div class="center">
            <div class="row">
                <span id="counter"></span>
            </div>
            <svg id="table" viewBox="0 -1 16 18" xmlns="http://www.w3.org/2000/svg">
                <defs>
                    <linearGradient id="to_left">
                        <!-- TODO: define background color in css and use that instead -->
                        <stop offset="0%" stop-color="white" />
                        <stop offset="100%" stop-color="white" stop-opacity="0" />
                    </linearGradient>
                    <linearGradient id="to_right">
                        <!-- TODO: define background color in css and use that instead -->
                        <stop offset="0%" stop-color="white" stop-opacity="0" />
                        <stop offset="100%" stop-color="white" />
                    </linearGradient>
                </defs>
            </svg>
            <button class="big center" id="answer">Answer</button>
        </div>
        <div id="modal" class="modal">
            <!-- Modal content -->
            <div class="modal-content">
                <span id="close" class="close">&times;</span>
                <svg id="track" viewbox="0 0 28 28">
                    <!-- <rect x="0" y="0" width="25" height="25" />
                    <text class="layout" id="modal_payout" x="12" y="12">0</text> -->
                </svg>
                <input class="center" id="modal_input" type="number">
                <input class="big center" id="modal_check" type="submit" value="Check">
                <div class="row">
                    <button class="big" id="next" hidden>Next</button>
                </div>
                <input id="modal_peek" type="button" value="peek">
            </div>

        </div>
    </body>

    <script type="module">
        import { View, TempView, POSITION } from "./game_logic.js"
        import { handle_next, open_modal, set_modal_event_listeners, state, build_em_up, knock_em_down } from "./ui_handlers.js"
        import { remove_classes } from "./utility.js"

        document.getElementById("next").onclick = handle_next
        document.getElementById("answer").onclick = open_modal

        document.getElementById("modal_input").oninput = (event) => {
            knock_em_down(document.getElementById("track"))
            const modal_view = new TempView(parseInt(event.target.value))
            build_em_up(document.getElementById("track"), modal_view)
        }

        set_modal_event_listeners()

        addEventListener('load', (event) => {
            document.documentElement.style.setProperty('--chip_color', sessionStorage.getItem('chip_color'))
            const pb_count = parseInt(sessionStorage.getItem('pb_count'))
            const half = Math.floor(pb_count / 2)
            // first half is single picture bets and second half has combinations of 2 pbs
            state.views = [...View.generate_views(half, 1), ...View.generate_views(pb_count - half, 2)]
            build_em_up(document.getElementById("table"), state.view)
        })

    </script>

</html>